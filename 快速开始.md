# Twitter 监控系统 - 快速开始

## 第一步：获取 Twitter API 密钥

1. 访问 https://developer.twitter.com/en/portal/dashboard
2. 登录 Twitter 账号
3. 创建一个新的 App
4. 在 Keys and tokens 页面生成 **Bearer Token**
5. 复制并保存 Bearer Token

## 第二步：配置环境变量

### macOS/Linux:

```bash
# 设置 Twitter API Token
export TWITTER_BEARER_TOKEN="你的-bearer-token"

# 设置 Redis URL (可选，使用默认值)
export REDIS_URL="redis://localhost:6379/0"
```

### Windows:

```cmd
set TWITTER_BEARER_TOKEN=你的-bearer-token
set REDIS_URL=redis://localhost:6379/0
```

或者创建 `.env` 文件（推荐）：

```bash
cp .env.example .env
# 编辑 .env 文件，填入你的 Twitter API Token
```

## 第三步：启动 Redis

### macOS:

```bash
# 安装 Redis
brew install redis

# 启动 Redis
redis-server
```

### Linux:

```bash
# Ubuntu/Debian
sudo apt-get install redis-server
sudo service redis-server start

# CentOS/RHEL
sudo yum install redis
sudo systemctl start redis
```

### Windows:

下载 Redis for Windows: https://github.com/microsoftarchive/redis/releases

或使用 Docker:

```bash
docker run -d -p 6379:6379 redis
```

## 第四步：运行项目

```bash
# 1. 激活虚拟环境
source venv/bin/activate  # Windows: venv\Scripts\activate

# 2. 数据库已迁移，创建超级用户
python manage.py createsuperuser
# 输入用户名、邮箱和密码

# 3. 启动 Django 开发服务器
python manage.py runserver
```

打开浏览器访问：http://localhost:8000/admin/

## 第五步：添加监控用户

### 方法 1: 使用管理命令（最简单）

```bash
# 在新终端中，激活虚拟环境后执行：
python manage.py add_twitter_user Twitter
python manage.py add_twitter_user elonmusk
```

### 方法 2: 使用 Admin 后台

1. 访问 http://localhost:8000/admin/
2. 登录后点击 "监控用户"
3. 点击 "添加监控用户"
4. 填写信息并保存

### 方法 3: 使用 API

```bash
curl -X POST http://localhost:8000/twitter/api/monitored-users/add_user/ \
  -H "Content-Type: application/json" \
  -d '{"username": "Twitter"}'
```

## 第六步：监控用户

### 手动监控：

```bash
# 监控所有用户
python manage.py monitor_twitter

# 监控指定用户
python manage.py monitor_twitter Twitter
```

### 自动监控（启动 Celery）：

```bash
# 终端 1: Celery Worker
celery -A mysite worker -l info

# 终端 2: Celery Beat (定时任务)
celery -A mysite beat -l info
```

## 第七步：查看数据

### Admin 后台：
http://localhost:8000/admin/

### API 接口：

```bash
# 查看监控用户
curl http://localhost:8000/twitter/api/monitored-users/

# 查看推文
curl http://localhost:8000/twitter/api/tweets/

# 查看回复
curl http://localhost:8000/twitter/api/replies/

# 查看监控日志
curl http://localhost:8000/twitter/api/logs/
```

## 测试功能

运行测试脚本：

```bash
python test_twitter_monitor.py
```

## 常见问题

### Q: "TWITTER_BEARER_TOKEN 未配置"

A: 确保已设置环境变量：

```bash
export TWITTER_BEARER_TOKEN="your-token"
# 或者在 .env 文件中配置
```

### Q: "Error connecting to Redis"

A: 确保 Redis 已启动：

```bash
redis-server
# 或检查 Redis 是否运行
redis-cli ping  # 应返回 PONG
```

### Q: 如何更改监控频率？

A: 编辑 `mysite/celery.py`，修改定时任务配置：

```python
'schedule': crontab(minute='*/30'),  # 每30分钟
'schedule': crontab(hour='*/1'),     # 每小时
'schedule': crontab(hour=9),         # 每天9点
```

### Q: 如何清理旧数据？

A: 运行清理任务：

```bash
python manage.py shell
>>> from twitter_monitor.tasks import cleanup_old_data_task
>>> cleanup_old_data_task(days=30)  # 清理30天前的数据
```

## 下一步

- 📖 查看完整文档：`TWITTER_MONITOR_README.md`
- 🔧 配置定时任务：编辑 `mysite/celery.py`
- 🚀 部署到生产环境：参考 Railway 部署指南

---

祝使用愉快！🎉
