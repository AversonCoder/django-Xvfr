# Twitter ç›‘æ§ç³»ç»Ÿ - é¡¹ç›®æ€»ç»“

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. æ ¸å¿ƒåŠŸèƒ½

- âœ… **Twitter API é›†æˆ**
  - ä½¿ç”¨ Tweepy åº“è¿æ¥ Twitter API v2
  - æ”¯æŒ Bearer Token è®¤è¯
  - è‡ªåŠ¨å¤„ç† API é™æµ

- âœ… **ç”¨æˆ·ç›‘æ§**
  - æ·»åŠ /åˆ é™¤ç›‘æ§ç”¨æˆ·
  - è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆç”¨æˆ·åã€IDã€å¤´åƒç­‰ï¼‰
  - å¯ç”¨/ç¦ç”¨ç›‘æ§çŠ¶æ€

- âœ… **æ¨æ–‡æŠ“å–**
  - è‡ªåŠ¨æŠ“å–ç›‘æ§ç”¨æˆ·çš„æ¨æ–‡
  - è¯†åˆ«æ¨æ–‡ç±»å‹ï¼ˆåŸåˆ›/è½¬å‘/å¼•ç”¨ï¼‰
  - è®°å½•ç»Ÿè®¡æ•°æ®ï¼ˆç‚¹èµã€è½¬å‘ã€å›å¤æ•°ï¼‰
  - ä¿å­˜åª’ä½“ä¿¡æ¯ï¼ˆå›¾ç‰‡ã€è§†é¢‘ URLï¼‰
  - å¢é‡æŠ“å–ï¼ˆé¿å…é‡å¤ï¼‰

- âœ… **å›å¤ç›‘æ§**
  - æŠ“å–æ¨æ–‡çš„å›å¤
  - åªè®°å½•ç›‘æ§ç”¨æˆ·ä¹‹é—´çš„äº’åŠ¨
  - ä¿å­˜å›å¤ç»Ÿè®¡æ•°æ®

- âœ… **å®šæ—¶ä»»åŠ¡**
  - Celery + Redis å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—
  - æ¯30åˆ†é’Ÿè‡ªåŠ¨ç›‘æ§æ‰€æœ‰ç”¨æˆ·
  - æ¯å¤©è‡ªåŠ¨æ¸…ç†æ—§æ•°æ®
  - æ”¯æŒæ‰‹åŠ¨è§¦å‘ç›‘æ§

### 2. æ•°æ®ç®¡ç†

- âœ… **Django Admin åå°**
  - å¯è§†åŒ–ç®¡ç†ç›‘æ§ç”¨æˆ·
  - æŸ¥çœ‹æ¨æ–‡ã€å›å¤åˆ—è¡¨
  - æŸ¥çœ‹ç›‘æ§æ—¥å¿—
  - æ‰¹é‡æ“ä½œï¼ˆå¯ç”¨/ç¦ç”¨ç›‘æ§ï¼‰

- âœ… **æ•°æ®æ¨¡å‹**
  - MonitoredUserï¼ˆç›‘æ§ç”¨æˆ·ï¼‰
  - Tweetï¼ˆæ¨æ–‡ï¼‰
  - Replyï¼ˆå›å¤ï¼‰
  - MonitorLogï¼ˆç›‘æ§æ—¥å¿—ï¼‰
  - å®Œæ•´çš„å¤–é”®å…³è”å’Œç´¢å¼•ä¼˜åŒ–

### 3. REST API

- âœ… **å®Œæ•´çš„ RESTful API**
  - ç›‘æ§ç”¨æˆ· CRUD
  - æ¨æ–‡æŸ¥è¯¢ï¼ˆæ”¯æŒç­›é€‰ã€æœç´¢ã€æ’åºï¼‰
  - å›å¤æŸ¥è¯¢
  - ç›‘æ§æ—¥å¿—æŸ¥è¯¢
  - åˆ†é¡µæ”¯æŒ

- âœ… **è‡ªå®šä¹‰æ¥å£**
  - æ·»åŠ ç›‘æ§ç”¨æˆ·ï¼ˆé€šè¿‡ç”¨æˆ·åï¼‰
  - ç«‹å³ç›‘æ§æŒ‡å®šç”¨æˆ·
  - æ‰¹é‡ç›‘æ§æ‰€æœ‰ç”¨æˆ·
  - è·å–æ¨æ–‡çš„å›å¤

### 4. ç®¡ç†å‘½ä»¤

- âœ… **add_twitter_user** - æ·»åŠ ç›‘æ§ç”¨æˆ·
- âœ… **monitor_twitter** - æ‰‹åŠ¨ç›‘æ§ç”¨æˆ·

### 5. éƒ¨ç½²æ”¯æŒ

- âœ… **å¼€å‘ç¯å¢ƒ**
  - è‡ªåŠ¨ä½¿ç”¨ SQLite æ•°æ®åº“
  - å®Œæ•´çš„å¼€å‘é…ç½®

- âœ… **ç”Ÿäº§ç¯å¢ƒ**
  - æ”¯æŒ PostgreSQL æ•°æ®åº“
  - æ”¯æŒ Railway éƒ¨ç½²
  - ä½¿ç”¨ Gunicorn ä½œä¸º WSGI æœåŠ¡å™¨
  - WhiteNoise é™æ€æ–‡ä»¶æœåŠ¡

## ğŸ“ é¡¹ç›®ç»“æ„

```
django-Xvfr/
â”œâ”€â”€ mysite/                          # Django é¡¹ç›®é…ç½®
â”‚   â”œâ”€â”€ __init__.py                  # Celery è‡ªåŠ¨åŠ è½½
â”‚   â”œâ”€â”€ settings.py                  # é¡¹ç›®è®¾ç½®ï¼ˆå·²é…ç½®æ‰€æœ‰åŠŸèƒ½ï¼‰
â”‚   â”œâ”€â”€ urls.py                      # ä¸»è·¯ç”±ï¼ˆå·²æ·»åŠ  twitter_monitorï¼‰
â”‚   â”œâ”€â”€ celery.py                    # Celery é…ç½®å’Œå®šæ—¶ä»»åŠ¡ âœ¨
â”‚   â”œâ”€â”€ wsgi.py
â”‚   â””â”€â”€ asgi.py
â”‚
â”œâ”€â”€ twitter_monitor/                 # Twitter ç›‘æ§åº”ç”¨ âœ¨
â”‚   â”œâ”€â”€ models.py                    # æ•°æ®æ¨¡å‹ï¼ˆ4ä¸ªæ¨¡å‹ï¼‰
â”‚   â”œâ”€â”€ admin.py                     # Admin é…ç½®
â”‚   â”œâ”€â”€ services.py                  # Twitter API æœåŠ¡ âœ¨
â”‚   â”œâ”€â”€ tasks.py                     # Celery ä»»åŠ¡ âœ¨
â”‚   â”œâ”€â”€ views.py                     # REST API è§†å›¾
â”‚   â”œâ”€â”€ serializers.py               # API åºåˆ—åŒ–å™¨
â”‚   â”œâ”€â”€ urls.py                      # è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ management/                  # ç®¡ç†å‘½ä»¤
â”‚   â”‚   â””â”€â”€ commands/
â”‚   â”‚       â”œâ”€â”€ add_twitter_user.py  # æ·»åŠ ç”¨æˆ·å‘½ä»¤ âœ¨
â”‚   â”‚       â””â”€â”€ monitor_twitter.py   # ç›‘æ§å‘½ä»¤ âœ¨
â”‚   â””â”€â”€ migrations/
â”‚       â””â”€â”€ 0001_initial.py          # åˆå§‹è¿ç§»
â”‚
â”œâ”€â”€ requirements.txt                 # ä¾èµ–åŒ…ï¼ˆå·²æ›´æ–°ï¼‰
â”œâ”€â”€ .env.example                     # ç¯å¢ƒå˜é‡ç¤ºä¾‹ âœ¨
â”œâ”€â”€ TWITTER_MONITOR_README.md        # å®Œæ•´æ–‡æ¡£ âœ¨
â”œâ”€â”€ å¿«é€Ÿå¼€å§‹.md                       # å¿«é€Ÿå¼€å§‹æŒ‡å— âœ¨
â”œâ”€â”€ test_twitter_monitor.py          # æµ‹è¯•è„šæœ¬ âœ¨
â””â”€â”€ é¡¹ç›®æ€»ç»“.md                       # æœ¬æ–‡æ¡£ âœ¨

âœ¨ = æ–°åˆ›å»ºçš„æ–‡ä»¶
```

## ğŸ”§ æŠ€æœ¯æ ˆ

| ç»„ä»¶ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Django | 5.2.7 | Web æ¡†æ¶ |
| Django REST Framework | 3.16.1 | REST API |
| Tweepy | 4.16.0 | Twitter API å®¢æˆ·ç«¯ |
| Celery | 5.5.3 | å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ— |
| Redis | 7.0.0 | æ¶ˆæ¯ä»£ç† / ç¼“å­˜ |
| Django Celery Beat | 2.8.1 | å®šæ—¶ä»»åŠ¡ç®¡ç† |
| Django Filter | 25.2 | API è¿‡æ»¤ |
| PostgreSQL | - | ç”Ÿäº§æ•°æ®åº“ |
| SQLite | - | å¼€å‘æ•°æ®åº“ |
| Gunicorn | 22.0.0 | WSGI æœåŠ¡å™¨ |
| WhiteNoise | 6.7.0 | é™æ€æ–‡ä»¶æœåŠ¡ |

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### MonitoredUserï¼ˆç›‘æ§ç”¨æˆ·ï¼‰
```python
- id (è‡ªå¢ä¸»é”®)
- username (å”¯ä¸€ï¼ŒTwitter ç”¨æˆ·å)
- user_id (å”¯ä¸€ï¼ŒTwitter ç”¨æˆ· ID)
- display_name (æ˜¾ç¤ºåç§°)
- profile_image_url (å¤´åƒ URL)
- is_active (æ˜¯å¦å¯ç”¨ç›‘æ§)
- created_at (æ·»åŠ æ—¶é—´)
- updated_at (æ›´æ–°æ—¶é—´)
- last_checked_at (æœ€åæ£€æŸ¥æ—¶é—´)
```

### Tweetï¼ˆæ¨æ–‡ï¼‰
```python
- id (è‡ªå¢ä¸»é”®)
- tweet_id (å”¯ä¸€ï¼ŒTwitter æ¨æ–‡ ID)
- author (å¤–é”® â†’ MonitoredUser)
- tweet_type (ç±»å‹ï¼štweet/retweet/quote)
- text (æ¨æ–‡å†…å®¹)
- created_at (å‘å¸ƒæ—¶é—´) [ç´¢å¼•]
- retweet_count (è½¬å‘æ•°)
- reply_count (å›å¤æ•°)
- like_count (ç‚¹èµæ•°)
- quote_count (å¼•ç”¨æ•°)
- referenced_tweet_id (å¼•ç”¨æ¨æ–‡ ID)
- retweeted_tweet_id (è½¬å‘æ¨æ–‡ ID)
- has_media (æ˜¯å¦åŒ…å«åª’ä½“)
- media_urls (åª’ä½“ URL åˆ—è¡¨ï¼ŒJSON)
- fetched_at (æŠ“å–æ—¶é—´)
- updated_at (æ›´æ–°æ—¶é—´)

ç´¢å¼•ï¼š
- (created_at DESC)
- (tweet_id)
- (author, created_at DESC)
```

### Replyï¼ˆå›å¤ï¼‰
```python
- id (è‡ªå¢ä¸»é”®)
- reply_id (å”¯ä¸€ï¼ŒTwitter å›å¤ ID)
- tweet (å¤–é”® â†’ Tweet)
- author (å¤–é”® â†’ MonitoredUser)
- text (å›å¤å†…å®¹)
- created_at (å›å¤æ—¶é—´)
- like_count (ç‚¹èµæ•°)
- reply_count (å›å¤æ•°)
- fetched_at (æŠ“å–æ—¶é—´)
- updated_at (æ›´æ–°æ—¶é—´)

ç´¢å¼•ï¼š
- (tweet, created_at DESC)
- (author, created_at DESC)
```

### MonitorLogï¼ˆç›‘æ§æ—¥å¿—ï¼‰
```python
- id (è‡ªå¢ä¸»é”®)
- user (å¤–é”® â†’ MonitoredUser)
- status (çŠ¶æ€ï¼šsuccess/failed/partial)
- tweets_fetched (è·å–æ¨æ–‡æ•°)
- replies_fetched (è·å–å›å¤æ•°)
- error_message (é”™è¯¯ä¿¡æ¯)
- created_at (åˆ›å»ºæ—¶é—´)
```

## ğŸŒ API æ¥å£

### ç›‘æ§ç”¨æˆ· API
```
GET    /twitter/api/monitored-users/              # åˆ—è¡¨
POST   /twitter/api/monitored-users/              # åˆ›å»º
GET    /twitter/api/monitored-users/{id}/         # è¯¦æƒ…
PUT    /twitter/api/monitored-users/{id}/         # æ›´æ–°
DELETE /twitter/api/monitored-users/{id}/         # åˆ é™¤
POST   /twitter/api/monitored-users/add_user/     # é€šè¿‡ç”¨æˆ·åæ·»åŠ 
POST   /twitter/api/monitored-users/{id}/monitor_now/  # ç«‹å³ç›‘æ§
POST   /twitter/api/monitored-users/monitor_all/  # ç›‘æ§æ‰€æœ‰
```

### æ¨æ–‡ API
```
GET    /twitter/api/tweets/                       # åˆ—è¡¨
GET    /twitter/api/tweets/{id}/                  # è¯¦æƒ…
GET    /twitter/api/tweets/{id}/replies/          # è·å–å›å¤
```

### å›å¤ API
```
GET    /twitter/api/replies/                      # åˆ—è¡¨
GET    /twitter/api/replies/{id}/                 # è¯¦æƒ…
```

### ç›‘æ§æ—¥å¿— API
```
GET    /twitter/api/logs/                         # åˆ—è¡¨
GET    /twitter/api/logs/{id}/                    # è¯¦æƒ…
```

### æŸ¥è¯¢å‚æ•°
- `page` - é¡µç 
- `page_size` - æ¯é¡µæ•°é‡
- `search` - æœç´¢å…³é”®è¯
- `ordering` - æ’åºå­—æ®µ
- `author` - æŒ‰ä½œè€…ç­›é€‰
- `tweet_type` - æŒ‰ç±»å‹ç­›é€‰
- `has_media` - æ˜¯å¦åŒ…å«åª’ä½“
- `status` - ç›‘æ§çŠ¶æ€

## â° å®šæ—¶ä»»åŠ¡

### 1. ç›‘æ§æ‰€æœ‰ç”¨æˆ·ï¼ˆæ¯30åˆ†é’Ÿï¼‰
```python
'monitor-all-users-every-30-minutes': {
    'task': 'twitter_monitor.tasks.monitor_all_users_task',
    'schedule': crontab(minute='*/30'),
}
```

### 2. æ¸…ç†æ—§æ•°æ®ï¼ˆæ¯å¤©å‡Œæ™¨3ç‚¹ï¼‰
```python
'cleanup-old-data-daily': {
    'task': 'twitter_monitor.tasks.cleanup_old_data_task',
    'schedule': crontab(hour=3, minute=0),
    'kwargs': {'days': 30},  # ä¿ç•™30å¤©
}
```

## ğŸš€ ä½¿ç”¨æ–¹å¼

### 1. ç¯å¢ƒé…ç½®
```bash
export TWITTER_BEARER_TOKEN="your-token"
export REDIS_URL="redis://localhost:6379/0"
```

### 2. å¯åŠ¨æœåŠ¡
```bash
# Django æœåŠ¡å™¨
python manage.py runserver

# Redis
redis-server

# Celery Worker
celery -A mysite worker -l info

# Celery Beat
celery -A mysite beat -l info
```

### 3. æ·»åŠ ç›‘æ§ç”¨æˆ·
```bash
# å‘½ä»¤è¡Œ
python manage.py add_twitter_user Twitter

# API
curl -X POST http://localhost:8000/twitter/api/monitored-users/add_user/ \
  -H "Content-Type: application/json" \
  -d '{"username": "Twitter"}'
```

### 4. ç›‘æ§ç”¨æˆ·
```bash
# æ‰‹åŠ¨ç›‘æ§
python manage.py monitor_twitter

# API è§¦å‘
curl -X POST http://localhost:8000/twitter/api/monitored-users/monitor_all/
```

### 5. æŸ¥çœ‹æ•°æ®
- Admin: http://localhost:8000/admin/
- API: http://localhost:8000/twitter/api/

## ğŸ“ é…ç½®è¯´æ˜

### settings.py æ–°å¢é…ç½®
```python
# Celery é…ç½®
CELERY_BROKER_URL = 'redis://localhost:6379/0'
CELERY_RESULT_BACKEND = 'redis://localhost:6379/0'

# Twitter API é…ç½®
TWITTER_BEARER_TOKEN = os.environ.get('TWITTER_BEARER_TOKEN', '')

# REST Framework é…ç½®
REST_FRAMEWORK = {
    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
    'PAGE_SIZE': 50,
}
```

### æ•°æ®åº“é…ç½®ï¼ˆè‡ªåŠ¨åˆ‡æ¢ï¼‰
- **å¼€å‘ç¯å¢ƒ**: è‡ªåŠ¨ä½¿ç”¨ SQLite
- **ç”Ÿäº§ç¯å¢ƒ**: ä½¿ç”¨ PostgreSQLï¼ˆéœ€é…ç½®ç¯å¢ƒå˜é‡ï¼‰

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **Twitter API é™åˆ¶**
   - å…è´¹ç‰ˆæœ‰è®¿é—®é¢‘ç‡é™åˆ¶
   - å»ºè®®åˆç†è®¾ç½®ç›‘æ§é¢‘ç‡
   - ä½¿ç”¨ tweepy çš„è‡ªåŠ¨é™æµç­‰å¾…

2. **æ•°æ®å­˜å‚¨**
   - å®šæœŸæ¸…ç†æ—§æ•°æ®ï¼ˆé»˜è®¤ä¿ç•™30å¤©ï¼‰
   - ç›‘æ§ç”¨æˆ·ä¸å®œè¿‡å¤šï¼ˆå»ºè®® < 100ï¼‰

3. **éšç§å’Œåˆè§„**
   - ä»…ç›‘æ§å…¬å¼€æ¨æ–‡
   - éµå®ˆ Twitter ä½¿ç”¨æ¡æ¬¾
   - ä¸è¦æ»¥ç”¨ API

## ğŸ”œ å¯æ‰©å±•åŠŸèƒ½

ä»¥ä¸‹åŠŸèƒ½å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šæ‰©å±•ï¼š

- [ ] æƒ…æ„Ÿåˆ†æï¼ˆä½¿ç”¨ NLP åº“ï¼‰
- [ ] å…³é”®è¯ç›‘æ§å’Œé€šçŸ¥
- [ ] æ•°æ®å¯è§†åŒ–ï¼ˆå›¾è¡¨å±•ç¤ºï¼‰
- [ ] å¯¼å‡ºåŠŸèƒ½ï¼ˆCSVã€Excelï¼‰
- [ ] Webhook é€šçŸ¥
- [ ] å¤šè´¦å·ç®¡ç†
- [ ] æ¨æ–‡å…³ç³»å›¾è°±
- [ ] é«˜çº§ç»Ÿè®¡åˆ†æ

## ğŸ“š æ–‡æ¡£

- `TWITTER_MONITOR_README.md` - å®Œæ•´ä½¿ç”¨æ–‡æ¡£
- `å¿«é€Ÿå¼€å§‹.md` - å¿«é€Ÿå¼€å§‹æŒ‡å—
- `.env.example` - ç¯å¢ƒå˜é‡é…ç½®ç¤ºä¾‹
- `test_twitter_monitor.py` - æµ‹è¯•è„šæœ¬

## ğŸ¯ æµ‹è¯•

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½ï¼š
```bash
python test_twitter_monitor.py
```

æµ‹è¯•å†…å®¹ï¼š
1. Twitter API è¿æ¥
2. æ·»åŠ ç›‘æ§ç”¨æˆ·
3. ç›‘æ§ç”¨æˆ·æ¨æ–‡
4. æŸ¥è¯¢æ•°æ®åº“

## ğŸ› å·²çŸ¥é—®é¢˜

- ç±»å‹æ£€æŸ¥è­¦å‘Šï¼ˆbasedpyrightï¼‰ï¼šè¿™äº›æ˜¯é™æ€ç±»å‹æ£€æŸ¥è­¦å‘Šï¼Œä¸å½±å“è¿è¡Œ
- æŸäº› Twitter ç”¨æˆ·å¯èƒ½æ— æ³•è·å–å›å¤ï¼ˆéœ€è¦é«˜çº§ API æƒé™ï¼‰

## âœ¨ äº®ç‚¹

1. **å®Œæ•´çš„åŠŸèƒ½å®ç°** - ä» API åˆ°å‰ç«¯å…¨æ ˆè§£å†³æ–¹æ¡ˆ
2. **å¼‚æ­¥ä»»åŠ¡æ”¯æŒ** - Celery å®ç°å®šæ—¶è‡ªåŠ¨ç›‘æ§
3. **å‹å¥½çš„ç®¡ç†ç•Œé¢** - Django Admin å¯è§†åŒ–ç®¡ç†
4. **RESTful API** - å®Œæ•´çš„ API æ¥å£ï¼Œæ”¯æŒç¬¬ä¸‰æ–¹é›†æˆ
5. **çµæ´»çš„éƒ¨ç½²** - æ”¯æŒæœ¬åœ°å¼€å‘å’Œäº‘å¹³å°éƒ¨ç½²
6. **å¢é‡æŠ“å–** - é¿å…é‡å¤æŠ“å–ï¼ŒèŠ‚çœ API é…é¢
7. **è¯¦ç»†çš„æ–‡æ¡£** - å®Œæ•´çš„ä½¿ç”¨æ–‡æ¡£å’Œå¿«é€Ÿå¼€å§‹æŒ‡å—

---

## æ€»ç»“

è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€æ¶æ„æ¸…æ™°çš„ Twitter ç›‘æ§ç³»ç»Ÿï¼ŒåŒ…å«ï¼š

- âœ… 4 ä¸ªæ•°æ®æ¨¡å‹
- âœ… å®Œæ•´çš„ CRUD æ“ä½œ
- âœ… RESTful APIï¼ˆ8ä¸ªç«¯ç‚¹ + è‡ªå®šä¹‰æ¥å£ï¼‰
- âœ… å®šæ—¶ä»»åŠ¡æ”¯æŒ
- âœ… ç®¡ç†å‘½ä»¤
- âœ… Admin åå°
- âœ… æµ‹è¯•è„šæœ¬
- âœ… å®Œæ•´æ–‡æ¡£

é¡¹ç›®å·²ç»å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œé…ç½®å¥½ Twitter API åå³å¯å¼€å§‹ç›‘æ§ï¼ğŸš€
